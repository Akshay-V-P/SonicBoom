<input type="hidden" id="pageName" value="orders">

<style>
    /* Specific styles for the orders details page content */
    .header {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 30px;
    }

    .order-card {
        background-color: #1a1a1a;
        border: 1px solid #333;
        border-radius: 12px;
        padding: 30px;
        max-width: 800px;
        margin: 0 auto;
    }

    .order-details-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px 40px;
        font-size: 14px;
    }

    .detail-item {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        position: relative;
    }

    .detail-label {
        font-weight: 500;
        color: #999;
        margin-right: 10px;
        min-width: 120px;
    }

    .detail-value {
        color: #ffffff;
        font-weight: 400;
        word-wrap: break-word;
        /* Ensure long text wraps */
        flex: 1;
    }

    .action-row {
        display: flex;
        align-items: center;
        margin-top: 20px;
        gap: 10px;
    }

    #items-header{
        position: absolute;
        top: 0;
    }

    .status-dropdown {
        background-color: #242428;
        color: #fff;
        border: 1px solid #404044;
        border-radius: 8px;
        padding: 8px 12px;
        font-size: 14px;
        cursor: pointer;
        appearance: none;
        -webkit-appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white' width='18px' height='18px'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 10px center;
        padding-right: 30px;
    }

    .update-btn {
        background-color: #4a90e2;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    .items-container{
        display: flex;
        flex-direction: column;
        margin-top: 18px;
        margin-left: 8px;
    }

    .update-btn:hover {
        background-color: #357ae8;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .order-details-grid {
            grid-template-columns: 1fr;
        }

        .action-row {
            flex-direction: column;
            align-items: flex-start;
        }

        .update-btn {
            width: 100%;
            text-align: center;
        }
    }
</style>

<div class="content-wrapper">
    {{#if orderDetails}}
    <div class="header">Orders details</div>

    <div class="order-card">
        <div class="order-details-grid">
            <!-- Left column -->
            <div class="left-col">
                <div class="detail-item">
                    <span class="detail-label">Reference No. :</span>
                    <span class="detail-value" id="orderId">{{orderDetails.orderId}}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Customer Name :</span>
                    <span class="detail-value">{{orderDetails.name}}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Mobile :</span>
                    <span class="detail-value">{{orderDetails.mobile}}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Shipping Address :</span>
                    <span class="detail-value">{{orderDetails.address}}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Shipping Cost :</span>
                    <span class="detail-value">₹{{orderDetails.deliveryCharge}}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Discount :</span>
                    <span class="detail-value">-{{orderDetails.discount}}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Total Amount :</span>
                    <span class="detail-value">₹{{orderDetails.total}}</span>
                </div>
            </div>

            <!-- Right column -->
            <div class="right-col">
                <div class="detail-item">
                    <span class="detail-label">Payment Method :</span>
                    <span class="detail-value">{{orderDetails.paymentMethod}}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Delivery Date :</span>
                    <span class="detail-value">{{orderDetails.orderDate}}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label" id="items-header">Items :</span>
                    <div class="items-container">
                        {{#each orderDetails.items}}
                           <span class="detail-value">{{inc @index}}. {{this}}</span>
                        {{/each}}
                    </div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Status :</span>
                    <select class="status-dropdown" id="status-select">
                        <option value="processing" {{#if (eq orderDetails.status 'processing')}}selected{{/if}}>Processing</option>
                        <option value="shipped" {{#if (eq orderDetails.status 'shipped')}}selected{{/if}}>Shipped</option>
                        <option value="out-for-delivery" {{#if (eq orderDetails.status 'out-for-delivery')}}selected{{/if}}>Out for delivery</option>
                        <option value="delivered" {{#if (eq orderDetails.status 'delivered')}}selected{{/if}}>Delivered</option>
                        <option value="cancelled" {{#if (eq orderDetails.status 'cancelled')}}selected{{/if}}>Cancelled</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="action-row">
            <button class="update-btn" id="update-status-btn">Update status</button>
        </div>
    </div>
    {{/if}}
</div>

<script>
    document.addEventListener("DOMContentLoaded", ()=>{
        const updateBtn = document.getElementById('update-status-btn');

        updateBtn.addEventListener('click', () => {
            const statusSelect = document.getElementById('status-select');
            const newStatus = statusSelect.value;

            Swal.fire({
                title: "Confirm Update",
                text: `Are you sure you want to change the status to "${newStatus}"?`,
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#4a90e2",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes, update it!",
                background: "#242428",
                color: "#ffffff",
                customClass: {
                    popup: 'my-swal-border'
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const orderId = document.getElementById('orderId').textContent.trim()
                    fetch(`/admin/orders/update-status?orderId=${orderId}`, {
                        method: "PATCH",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ status: newStatus })
                    })
                        .then(response => {
                            if (!response.ok) throw new Error("Can't fetch")
                            Swal.fire({
                                title: "Updated!",
                                text: "The order status has been updated.",
                                icon: "success",
                                background: "#242428",
                                color: "#ffffff",
                                customClass: {
                                    popup: 'my-swal-border'
                                }
                            });
                        })
                        .catch(error => {
                            console.log(error)
                        })

                }
            });
        });
    })
</script>